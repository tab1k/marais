{% load static %}
{% if top_banners %}
<div class="top-banner" id="top-banner" style="display: block;">
  <button class="top-banner__close" aria-label="Close" style="cursor: pointer;">✕</button>
  <div class="top-banner__link">
    <div class="marquee-track">
      <p class="top-banner__text">
        {% for banner in top_banners %}
        <a href="{{ banner.link|default:'#' }}" style="color: inherit; text-decoration: none;">{{ banner.text|upper }}</a>
        &nbsp;&nbsp;&nbsp;&nbsp; • &nbsp;&nbsp;&nbsp;&nbsp;
        {% endfor %}
        {% for banner in top_banners %}
        <a href="{{ banner.link|default:'#' }}" style="color: inherit; text-decoration: none;">{{ banner.text|upper }}</a>
        &nbsp;&nbsp;&nbsp;&nbsp; • &nbsp;&nbsp;&nbsp;&nbsp;
        {% endfor %}
      </p>
    </div>
  </div>
</div>
<script>
  (function () {
    var banner = document.getElementById('top-banner');
    if (sessionStorage.getItem('hideTopBanner')) {
      banner.style.display = 'none';
    }

    var closeBtn = document.querySelector('.top-banner__close');
    if (closeBtn) {
      closeBtn.addEventListener('click', function (e) {
        e.preventDefault();
        banner.style.display = 'none';
        sessionStorage.setItem('hideTopBanner', 'true');
      });
    }
  })();
</script>
{% endif %}
<header class="site-header">

  <div class="container-m header-inner">
    <button class="burger" aria-label="Меню" type="button" data-menu-toggle>
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="header-nav">
      <a href="{% url 'catalog:home' %}" class="">Магазин</a>
      <div class="nav-dropdown" style="position: relative;">
        <button type="button" class="nav-dropdown__trigger" aria-haspopup="true" aria-expanded="false">Бренды</button>
        <div class="nav-dropdown__menu"
          style="position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(-10px); min-width: 180px; background: #fff; border: 1px solid #e6e1da; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.12); padding: 12px 0; margin-top: 16px; opacity: 0; visibility: hidden; transition: opacity 0.25s ease, visibility 0.25s ease, transform 0.25s ease; z-index: 200;">
          {% for brand in all_brands %}
          <a href="{% url 'brand_detail' brand.slug %}" class="nav-dropdown__item"
            style="display: block; padding: 10px 20px; font-size: 14px; color: #333; text-decoration: none; white-space: nowrap;">{{ brand.name }}</a>
          {% empty %}
          <span class="nav-dropdown__item" style="display: block; padding: 10px 20px;">Нет брендов</span>
          {% endfor %}
        </div>
      </div>
      <a href="{% url 'project' %}" class="">О нас</a>
    </nav>
    <style>
      .nav-dropdown:hover .nav-dropdown__menu {
        opacity: 1 !important;
        visibility: visible !important;
        transform: translateX(-50%) translateY(0) !important;
      }

      .nav-dropdown__item:hover {
        background: #f9f7f5;
        color: #640406 !important;
      }
    </style>

    <div class="header-logo">
      <a href="{% url 'general' %}">
        <img src="{% static 'images/logo.png' %}" alt="Marais">
      </a>
    </div>



    <div class="header-actions header-actions--compact">
      <img src="{% static 'images/Phone.png' %}" alt="Phone" class="icon-link" id="contact-modal-trigger"
        style="cursor: pointer;">

      <!-- Contact Modal -->
      <div class="contact-modal" id="contact-modal">
        <div class="contact-modal__content">
          <p class="contact-modal__phone">+7 (777) 255-53-48</p>
          <p class="contact-modal__email">kz.marais.info@gmail.com</p>
          <div class="contact-modal__socials">
            <a href="https://wa.me/message/CLSRMWNCKRLJO1" target="_blank">
              <img src="{% static 'images/whatsapp.svg' %}" alt="WhatsApp">
            </a>
            <a href="https://instagram.com/marais.kz" target="_blank">
              <img src="{% static 'images/instagram.svg' %}" alt="Instagram">
            </a>
          </div>
        </div>
      </div>
      <a href="{% url 'basket:detail' %}"><img src="{% static 'images/Vector.png' %}" alt="Cart" class="icon-link"></a>
      <img src="{% static 'images/Serch.png' %}" alt="Search" class="icon-link" data-search-trigger
        style="cursor: pointer;">
      {% if request.user.is_authenticated %}
      <a href="{% url 'catalog:profile' %}">
        <img src="{% static 'images/profile.png' %}" alt="Profile" class="icon-link">
      </a>
      {% else %}
      <a href="{% url 'users:login' %}">
        <img src="{% static 'images/profile.png' %}" alt="Profile" class="icon-link">
      </a>
      {% endif %}
    </div>
  </div>
  <div class="mobile-menu" data-menu>
    <div class="mobile-menu__backdrop" data-menu-backdrop></div>
    <div class="mobile-menu__panel">
      <button class="mobile-menu__close" type="button" aria-label="Закрыть меню" data-menu-close>✕</button>
      <nav class="mobile-menu__nav">
        <a href="/" class="mobile-menu__link">Главная</a>
        <a href="{% url 'catalog:home' %}" class="mobile-menu__link">Магазин</a>
        <details class="mobile-menu__accordion">
          <summary class="mobile-menu__link">Бренды</summary>
          <div class="mobile-menu__submenu">
            {% for brand in all_brands %}
            <a href="{% url 'brand_detail' brand.slug %}" class="mobile-menu__sublink">{{ brand.name }}</a>
            {% empty %}
            <span class="mobile-menu__sublink mobile-menu__sublink--empty">Нет брендов</span>
            {% endfor %}
          </div>
        </details>
        <details class="mobile-menu__accordion">
          <summary class="mobile-menu__link">Коллекции</summary>
          <div class="mobile-menu__submenu">
            {% for col in all_collections %}
            <a href="{% url 'catalog:home' %}?collection={{ col.slug }}" class="mobile-menu__sublink">{{ col.name }}</a>
            {% empty %}
            <span class="mobile-menu__sublink mobile-menu__sublink--empty">Нет коллекций</span>
            {% endfor %}
          </div>
        </details>
        <a href="{% url 'project' %}" class="mobile-menu__link">О нас</a>
        <a href="{% url 'basket:detail' %}" class="mobile-menu__link">Корзина</a>
      </nav>

      <div class="mobile-menu__footer">
        <div class="mobile-menu__user-section">
          <a class="mobile-user"
            href="{% if request.user.is_authenticated %}{% url 'catalog:profile' %}{% else %}{% url 'users:login' %}{% endif %}">
            <span class="mobile-user__avatar">
              {% if request.user.is_authenticated and request.user.avatar %}
              <img src="{{ request.user.avatar.url }}"
                alt="{{ request.user.get_full_name|default:request.user.username }}">
              {% else %}
              <img src="{% static 'images/sergi.png' %}" alt="Профиль">
              {% endif %}
            </span>
            <span class="mobile-user__meta">
              <span class="mobile-user__name">
                {% if request.user.is_authenticated %}
                {{ request.user.get_full_name|default:request.user.username }}
                {% else %}
                Гость
                {% endif %}
              </span>
              <span class="mobile-user__email">
                {% if request.user.is_authenticated %}
                {{ request.user.email }}
                {% else %}
                Войти или зарегистрироваться
                {% endif %}
              </span>
            </span>
          </a>
        </div>

        <div class="mobile-menu__contacts">
          <span class="mobile-menu__footer-label">Связаться с нами</span>
          <div class="mobile-menu__socials" style="display: flex; gap: 16px; margin: 12px 0;">
            <a href="https://wa.me/message/CLSRMWNCKRLJO1" target="_blank">
              <img src="{% static 'images/whatsapp.svg' %}" alt="WhatsApp" style="width: 24px; height: 24px;">
            </a>
            <a href="https://instagram.com/marais.kz" target="_blank">
              <img src="{% static 'images/instagram.svg' %}" alt="Instagram" style="width: 24px; height: 24px;">
            </a>
          </div>
          <div class="mobile-menu__contacts-list">
            <a href="tel:+77772555348" class="mobile-menu__contact-link">+7 (777) 255-53-48</a>
            <a href="mailto:kz.marais.info@gmail.com" class="mobile-menu__contact-link">kz.marais.info@gmail.com</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>