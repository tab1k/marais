<!DOCTYPE html>
{% load static %}
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description"
        content="Marais - уникальные, концептуальные украшения, тщательно собранные из разных стран.">
    <meta name="keywords" content="украшения, концептуальные украшения, Marais, модные украшения, уникальные украшения">
    <meta name="author" content="Marais">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon/16x16.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon/32x32.png' %}">
    <link rel="icon" type="image/png" sizes="48x48" href="{% static 'favicon/48x48.png' %}">
    <title>{% block title %}Marais{% endblock %}</title>
    <!-- Preload fonts (woff2 for best performance) -->
    <link rel="preload" href="{% static 'fonts/Jost-VariableFont_wght.woff2' %}" as="font" type="font/woff2"
        crossorigin>
    <link rel="preload" href="{% static 'fonts/Jost-Italic-VariableFont_wght.woff2' %}" as="font" type="font/woff2"
        crossorigin>

    <!-- Bootstrap CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Project CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <!-- Header & Footer split styles -->
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    {% block head %}{% endblock %}
</head>

<body>
    {% include 'includes/header.html' %}

    <main class="container-fluid p-0 flex-grow-1" role="main">
        {% block content %}{% endblock %}
    </main>

    {% include 'includes/footer.html' %}

    <!-- Bootstrap JS (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
    {% block scripts %}{% endblock %}
    <!-- Search Modal -->
    <div class="search-modal-backdrop" data-search-backdrop></div>
    <div class="search-modal" data-search-modal>
        <button class="search-modal-close" data-search-close>&times;</button>
        <div class="search-modal-content">
            <input type="text" class="search-input" placeholder="Поиск по каталогу..." data-search-input>
            <div class="search-results" data-search-results></div>
        </div>
    </div>

    {% if site_settings and site_settings.promo_is_active and site_settings.promo_image %}
        <!-- Promo Modal -->
        <div class="promo-modal-backdrop" data-promo-backdrop></div>
        <div class="promo-modal" data-promo-modal aria-modal="true" role="dialog">
            <button class="promo-modal__close" data-promo-close aria-label="Закрыть">×</button>
            <a class="promo-modal__link" href="{{ site_settings.promo_link|default:'#' }}">
                <div class="promo-modal__media" style="--promo-img: url('{{ site_settings.promo_image.url }}');">
                    <div class="promo-modal__overlay">
                        <div class="promo-modal__glass">
                            {% if site_settings.promo_eyebrow %}
                                <p class="promo-modal__eyebrow">{{ site_settings.promo_eyebrow }}</p>
                            {% endif %}
                            <h3 class="promo-modal__title">{{ site_settings.promo_title|default:"Новая коллекция" }}</h3>
                            {% if site_settings.promo_text %}
                                <p class="promo-modal__text">{{ site_settings.promo_text }}</p>
                            {% endif %}
                            <span class="promo-modal__hint">Нажмите, чтобы открыть подборку</span>
                        </div>
                    </div>
                </div>
            </a>
        </div>
    {% endif %}

    <style>
        .search-modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1040;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .search-modal-backdrop.is-visible {
            opacity: 1;
            pointer-events: auto;
        }

        .search-modal {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 400px;
            height: 100%;
            background: #fff;
            z-index: 1050;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .search-modal.is-visible {
            transform: translateX(0);
        }

        .search-modal-close {
            align-self: flex-end;
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-input {
            width: 100%;
            padding: 12px 0;
            border: none;
            border-bottom: 1px solid #ddd;
            font-size: 18px;
            outline: none;
            margin-bottom: 20px;
        }

        .search-input:focus {
            border-bottom-color: #a71930;
        }

        .search-results {
            flex: 1;
            overflow-y: auto;
        }

        .search-result-item {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            text-decoration: none;
            color: inherit;
        }

        .search-result-item:hover {
            background-color: #f9f9f9;
        }

        .search-item-thumb {
            width: 50px;
            height: 50px;
            border-radius: 4px;
        }

        .search-item-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .search-item-title {
            font-size: 14px;
            font-weight: 500;
        }

        .search-item-price {
            font-size: 13px;
            color: #666;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.querySelector('[data-promo-modal]');
            const backdrop = document.querySelector('[data-promo-backdrop]');
            const closeBtn = document.querySelector('[data-promo-close]');
            const storageKey = 'promoModalSeenAt';
            const ttlMs = 24 * 60 * 60 * 1000; // 24h
            let lockedScrollY = 0;

            if (!modal || !backdrop) return;

            const lockScroll = () => {
                lockedScrollY = window.scrollY || window.pageYOffset || 0;
                document.body.dataset.promoScroll = lockedScrollY;
                document.body.style.top = `-${lockedScrollY}px`;
                document.body.classList.add('promo-locked');
            };

            const unlockScroll = () => {
                const y = parseInt(document.body.dataset.promoScroll || '0', 10);
                document.body.classList.remove('promo-locked');
                document.body.style.top = '';
                window.scrollTo(0, y);
            };

            const open = () => {
                modal.classList.add('is-visible');
                backdrop.classList.add('is-visible');
                lockScroll();
            };
            const close = () => {
                modal.classList.remove('is-visible');
                backdrop.classList.remove('is-visible');
                unlockScroll();
                localStorage.setItem(storageKey, Date.now().toString());
            };

            const lastSeen = Number(localStorage.getItem(storageKey) || 0);
            const shouldShow = !lastSeen || (Date.now() - lastSeen > ttlMs);
            if (shouldShow) {
                setTimeout(open, 800);
            }

            closeBtn?.addEventListener('click', close);
            backdrop.addEventListener('click', close);
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.classList.contains('is-visible')) {
                    close();
                }
            });
        });
    </script>

    {% if cart_total_quantity > 0 and request.resolver_match.app_name != 'basket' %}
    <a href="{% url 'basket:detail' %}" class="floating-cart">
        <span class="floating-cart__icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M9 20C9 21.1046 8.10457 22 7 22C5.89543 22 5 21.1046 5 20C5 18.8954 5.89543 18 7 18C8.10457 18 9 18.8954 9 20Z"
                    fill="white" />
                <path
                    d="M20 20C20 21.1046 19.1046 22 18 22C16.8954 22 16 21.1046 16 20C16 18.8954 16.8954 18 18 18C19.1046 18 20 18.8954 20 20Z"
                    fill="white" />
                <path
                    d="M1 1H4L6.68 14.39C6.77144 14.8504 7.02191 15.264 7.3917 15.5583C7.76149 15.8526 8.22583 16.0087 8.695 16H19.4C19.8692 16.0087 20.3335 15.8526 20.7033 15.5583C21.0731 15.264 21.3236 14.8504 21.415 14.39L23 6H6"
                    stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </span>
        <span class="floating-cart__badge">{{ cart_total_quantity }}</span>
    </a>
    <style>
        .floating-cart {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: #a71930;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .floating-cart:hover {
            transform: scale(1.1);
        }

        .floating-cart__badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #c9a35e;
            /* Gold color for contrast, or red if requested specifically, but button is red so gold is better */
            color: white;
            font-size: 12px;
            font-weight: bold;
            min-width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #fff;
        }
    </style>
    {% endif %}

    {% if site_settings and site_settings.is_snow_enabled %}
    <style>
        .snowflake {
            color: #fff;
            font-size: 1em;
            font-family: Arial;
            text-shadow: 0 0 1px #000;
            position: fixed;
            top: -10%;
            z-index: 9999;
            user-select: none;
            cursor: default;
            animation-name: snowflakes-fall, snowflakes-shake;
            animation-duration: 10s, 3s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
            animation-play-state: running, running;
        }

        @keyframes snowflakes-fall {
            0% {
                top: -10%;
            }

            100% {
                top: 100%;
            }
        }

        @keyframes snowflakes-shake {
            0% {
                transform: translateX(0px);
            }

            50% {
                transform: translateX(80px);
            }

            100% {
                transform: translateX(0px);
            }
        }

        .snowflake:nth-of-type(0) {
            left: 1%;
            animation-delay: 0s, 0s;
        }

        .snowflake:nth-of-type(1) {
            left: 10%;
            animation-delay: 1s, 1s;
        }

        .snowflake:nth-of-type(2) {
            left: 20%;
            animation-delay: 6s, .5s;
        }

        .snowflake:nth-of-type(3) {
            left: 30%;
            animation-delay: 4s, 2s;
        }

        .snowflake:nth-of-type(4) {
            left: 40%;
            animation-delay: 2s, 2s;
        }

        .snowflake:nth-of-type(5) {
            left: 50%;
            animation-delay: 8s, 3s;
        }

        .snowflake:nth-of-type(6) {
            left: 60%;
            animation-delay: 6s, 2s;
        }

        .snowflake:nth-of-type(7) {
            left: 70%;
            animation-delay: 2.5s, 1s;
        }

        .snowflake:nth-of-type(8) {
            left: 80%;
            animation-delay: 1s, 0s;
        }

        .snowflake:nth-of-type(9) {
            left: 90%;
            animation-delay: 3s, 1.5s;
        }
    </style>
    <div class="snowflakes" aria-hidden="true">
        <div class="snowflake">❅</div>
        <div class="snowflake">❅</div>
        <div class="snowflake">❆</div>
        <div class="snowflake">❄</div>
        <div class="snowflake">❅</div>
        <div class="snowflake">❆</div>
        <div class="snowflake">❄</div>
        <div class="snowflake">❅</div>
        <div class="snowflake">❆</div>
        <div class="snowflake">❄</div>
    </div>
    {% endif %}
</body>

</html>
