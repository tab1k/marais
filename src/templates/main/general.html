{% extends 'base.html' %}
{% load static %}

{% block title %}MARAIS — концептуальные украшения из разных стран{% endblock %}

{% block content %}

<!-- Hero section -->
<div class="container-m hero-wrapper" style="margin-bottom: 30px;">
  {% if hero_block and hero_block.image %}
  <img class="hero-image" src="{{ hero_block.image.url|default:hero_block.image.url }}" alt="{{ hero_block.title|default:'Hero' }}"
    loading="eager"
    srcset="{{ hero_block.image.url }} 1200w, {{ hero_block.image.url }} 800w, {{ hero_block.image.url }} 480w"
    sizes="(max-width: 600px) 100vw, (max-width: 1200px) 90vw, 1380px">
  {% else %}
  <img class="hero-image" src="{% static 'images/hero_image.webp' %}" alt="Hero image" loading="eager"
    srcset="{% static 'images/hero_image.webp' %} 1200w, {% static 'images/hero_image.webp' %} 800w, {% static 'images/hero_image.webp' %} 480w"
    sizes="(max-width: 600px) 100vw, (max-width: 1200px) 90vw, 1380px">
  {% endif %}
</div>

<!-- 

<section>
  <div class="container-m">
    <div class="categories-text">
      <h2 class="mobile-hero-title">Истории, рассказанные в <span class="mobile-break">Серебре &amp; Золоте</span></h2>
    </div>
  </div>
</section> -->

<!-- Tagline Section -->
<section>
  <div class="container-m">
    <h2 style="text-align: center; font-size: 24px; font-weight: 350; letter-spacing: 1.5px; color: #333;">
      Концептуальные украшения из разных стран
    </h2>
  </div>
</section>

<!-- Categories section (4 items) -->
<section class="categories">
  <div class="container-m">
    <div class="categories-grid">
      {% for cat in categories %}
      <a href="{% url 'catalog:home' %}?category={{ cat.slug }}" class="category-card"
        style="text-decoration: none; color: inherit;">
        <div class="category-card__image-wrapper">
          {% if cat.image %}
          <img src="{{ cat.image.url }}" alt="{{ cat.name }}" loading="lazy">
          {% elif cat.slug == 'rings' or cat.slug == 'ring' %}
          <img src="{% static 'images/kolca.webp' %}" alt="{{ cat.name }}" loading="lazy"
            srcset="{% static 'images/kolca.webp' %} 400w, {% static 'images/kolca.webp' %} 800w"
            sizes="(max-width: 600px) 50vw, 320px">
          {% elif cat.slug == 'earrings' %}
          <img src="{% static 'images/sergi.webp' %}" alt="{{ cat.name }}" loading="lazy"
            srcset="{% static 'images/sergi.webp' %} 400w, {% static 'images/sergi.webp' %} 800w"
            sizes="(max-width: 600px) 50vw, 320px">
          {% elif cat.slug == 'necklaces' or cat.slug == 'necklace' %}
          <img src="{% static 'images/cepochki.webp' %}" alt="{{ cat.name }}" loading="lazy"
            srcset="{% static 'images/cepochki.webp' %} 400w, {% static 'images/cepochki.webp' %} 800w"
            sizes="(max-width: 600px) 50vw, 320px">
          {% elif cat.slug == 'bracelets' or cat.slug == 'bracelet' %}
          <img src="{% static 'images/braslet.webp' %}" alt="{{ cat.name }}" loading="lazy"
            srcset="{% static 'images/braslet.webp' %} 400w, {% static 'images/braslet.webp' %} 800w"
            sizes="(max-width: 600px) 50vw, 320px">
          {% else %}
          <img src="{% static 'images/zaglushka.png' %}" alt="{{ cat.name }}" class="product-brand-placeholder" loading="lazy"
            style="padding: 40px; opacity: 0.8;">
          {% endif %}
        </div>
        <p>{{ cat.name }}</p>
      </a>
      {% endfor %}
    </div>
  </div>
</section>


<!-- Dynamic Homepage Blocks -->
{% for block in blocks %}

{% if block.block_type == 'brand' %}
<!-- Brand Spotlight: Image + Featured Product -->
<section class="split-section">
  <div class="container-m split-grid">
    <div class="split-media" style="align-items: center;text-align: center;margin: auto;">
      {% if block.image %}
      <a href="{% if block.link_url %}{{ block.link_url }}{% elif block.brand %}{% url 'catalog:home' %}?brand={{ block.brand.name|urlencode }}{% else %}#{% endif %}">
        <img src="{{ block.image.url }}" alt="{{ block.brand.name }}" loading="lazy"
          srcset="{{ block.image.url }} 1200w, {{ block.image.url }} 800w, {{ block.image.url }} 480w"
          sizes="(max-width: 600px) 100vw, (max-width: 1200px) 90vw, 640px">
      </a>
      {% endif %}
    </div>
    <div class="split-content" style="justify-content: center; text-align: center;">
      <h2 class="split-title">КОЛЛЕКЦИЯ <br> {{ block.brand.name|upper }}</h2>
      <a href="{% if block.link_url %}{{ block.link_url }}{% elif block.brand %}{% url 'catalog:home' %}?brand={{ block.brand.name|urlencode }}{% else %}#{% endif %}" class="split-button">Посмотреть больше</a>

      {% if block.featured_product and block.featured_product.is_active %}
      <a href="{% url 'catalog:detail' block.featured_product.slug %}" style="text-decoration: none; color: inherit;">
        <div class="featured-product" style="display: flex; flex-direction: column; align-items: center;">
          {% static 'images/zaglushka.png' as zaglushka_url %}
          {% if block.featured_product.get_main_image_url %}
          <img src="{{ block.featured_product.get_main_image_url }}" alt="{{ block.featured_product.title }}"
            onerror="this.onerror=null;this.src='{{ zaglushka_url }}';" loading="lazy">
          {% else %}
          <img src="{{ zaglushka_url }}" alt="{{ block.featured_product.title }}" class="product-brand-placeholder"
            style="padding: 40px; opacity: 0.8;">
          {% endif %}
          <div class="featured-meta" style="text-align: center; width: 100%;">
            <p class="home-product-price" style="width: 100%; justify-content: space-between; text-align: left;">
              {{ block.featured_product.title|upper }} <span>{{ block.featured_product.price|floatformat:0 }}₸</span>
            </p>
            <p class="home-product-note">{{ block.featured_product.metal }}</p>
          </div>
        </div>
      </a>
      {% endif %}
    </div>
  </div>
</section>

<section class="mobile-flouida">
  <div class="container-m">
    <div class="categories-text">
      <h2 class="split-title">{{ block.brand.name|upper }}<br>COLLECTION</h2>
    </div>
    <a href="{% if block.link_url %}{{ block.link_url }}{% elif block.brand %}{% url 'catalog:home' %}?brand={{ block.brand.name|urlencode }}{% else %}#{% endif %}" class="split-button">Посмотреть больше</a>
  </div>
</section>

<section class="mobile-full-bleed">
  <div class="container-m">
    {% if block.image %}
          <img src="{{ block.image.url }}" alt="{{ block.brand.name }}" class="full-bleed-image" loading="lazy"
            srcset="{{ block.image.url }} 1200w, {{ block.image.url }} 800w, {{ block.image.url }} 480w"
            sizes="(max-width: 600px) 100vw, (max-width: 1200px) 90vw, 1380px">
    {% endif %}
  </div>
</section>

<!-- Brand Products Grid -->
<section class="categories">
  <div class="container-m">
    <div class="categories-grid">
      {% for prod in block.brand.active_products|slice:":4" %}
      <a href="{% url 'catalog:detail' prod.slug %}" class="category-card" style="text-decoration:none; color:inherit;">
        <div class="category-card__image-wrapper">
          {% static 'images/zaglushka.png' as zaglushka_url %}
          {% if prod.get_main_image_url %}
          <img src="{{ prod.get_main_image_url }}" alt="{{ prod.title }}"
            onerror="this.onerror=null;this.src='{{ zaglushka_url }}';" loading="lazy">
          {% elif prod.brand_ref and prod.brand_ref.logo %}
          <img src="{{ prod.brand_ref.logo.url }}" alt="{{ prod.title }}" class="product-brand-placeholder"
            onerror="this.onerror=null;this.src='{{ zaglushka_url }}';" loading="lazy">
          {% else %}
          <img src="{{ zaglushka_url }}" alt="{{ prod.title }}" class="product-brand-placeholder"
            style="padding: 40px; opacity: 0.8;" loading="lazy">
          {% endif %}
        </div>
        <div class="home-product-info">
          <p class="home-product-price">{{ prod.title|upper }} <span>{{ prod.price|floatformat:0 }}₸</span></p>
          <p class="home-product-note">{{ prod.metal|default:block.brand.name }}</p>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
</section>

{% elif block.block_type == 'banner' %}
<!-- Mishes-style Banner -->
<section>
  <div class="container-m" style="margin-top: 30px;">
    <div class="categories-text">
      <h2>{{ block.title }}</h2>
    </div>
  </div>
</section>

<section class="mishes-hero">
  <div class="container-m mishes-banner">
    {% if block.image %}
    <img src="{{ block.image.url }}" alt="{{ block.title }}" class="mishes-image">
    {% endif %}
    <img class="banner-decor banner-decor--left" src="{% static 'images/lefft.png' %}" alt="">
    <img class="banner-decor banner-decor--right" src="{% static 'images/rightt.png' %}" alt="">
    <div class="mishes-overlay">
      <h3 class="mishes-title">{{ block.subtitle }}</h3>
      {% if block.link_url %}
      <a class="mishes-button" href="{{ block.link_url }}">Перейти</a>
      {% endif %}
    </div>
  </div>
</section>
{% endif %}

{% endfor %}


<!-- Testimonials section -->
<section class="reviews">
  <div class="container-m">
    <h2 class="section-title">Отзывы</h2>
    <div class="reviews-header">
      <p class="reviews-lead">Наши клиенты делятся впечатлениями о покупках</p>
      <div class="reviews-nav">
        <button class="reviews-arrow" type="button" data-bs-target="#reviewsCarousel" data-bs-slide="prev"
          aria-label="Предыдущий отзыв">‹</button>
        <button class="reviews-arrow" type="button" data-bs-target="#reviewsCarousel" data-bs-slide="next"
          aria-label="Следующий отзыв">›</button>
      </div>
    </div>
    <div class="reviews-grid reviews-grid-desktop wide">
      {% for review in reviews %}
      <div class="review-card review-centered">
        <div class="review-body">
          <div class="stars">
            {% for i in "12345"|slice:":"|make_list %}
            {% if forloop.counter <= review.rating %}★{% else %}☆{% endif %} {% endfor %} </div>
              <p class="review-text">"{{ review.text }}"</p>
          </div>
          <div class="review-footer">
            <img class="review-avatar-img"
              src="https://ui-avatars.com/api/?name={{ review.name }}&background=640406&color=fff&size=120"
              alt="{{ review.name }}">
            <div class="review-meta">
              <p class="review-author">{{ review.name }}</p>
              <p class="review-city">{{ review.city }}</p>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="review-card review-centered" style="grid-column: 1/-1;">
          <p style="text-align: center; padding: 40px;">Пока нет отзывов. Будьте первым!</p>
        </div>
        {% endfor %}
      </div>
      <div id="reviewsCarousel" class="carousel slide reviews-carousel-mobile" data-bs-ride="carousel"
        data-bs-touch="true">
        <div class="carousel-inner">
          {% for review in reviews %}
          <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <div class="review-card review-centered">
              <div class="review-body">
                <div class="stars">
                  {% for i in "12345"|slice:":"|make_list %}
                  {% if forloop.counter <= review.rating %}★{% else %}☆{% endif %} {% endfor %} </div>
                    <p class="review-text">"{{ review.text }}"</p>
                </div>
                <div class="review-footer">
                  <img class="review-avatar-img"
                    src="https://ui-avatars.com/api/?name={{ review.name }}&background=640406&color=fff&size=120"
                    alt="{{ review.name }}">
                  <div class="review-meta">
                    <p class="review-author">{{ review.name }}</p>
                    <p class="review-city">{{ review.city }}</p>
                  </div>
                </div>
              </div>
            </div>
            {% empty %}
            <div class="carousel-item active">
              <div class="review-card review-centered">
                <p style="text-align: center; padding: 40px;">Пока нет отзывов. Будьте первым!</p>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        <div class="reviews-cta">
          <a class="split-button reviews-button" href="#" data-review-modal-trigger>Оставить отзыв</a>
        </div>
      </div>
</section>

<!-- Review Modal -->
<div class="review-modal" data-review-modal>
  <div class="review-modal__backdrop" data-review-modal-backdrop></div>
  <div class="review-modal__content">
    <button class="review-modal__close" data-review-modal-close aria-label="Закрыть">✕</button>
    <h2 class="review-modal__title">Оставить отзыв</h2>
    <form class="review-form" method="post" id="review-form">
      {% csrf_token %}
      <div class="review-form__group">
        <label for="review-name">Ваше имя</label>
        <input type="text" id="review-name" name="name" required>
      </div>
      <div class="review-form__group">
        <label for="review-city">Город</label>
        <input type="text" id="review-city" name="city" required>
      </div>
      <div class="review-form__group">
        <label for="review-rating">Оценка</label>
        <div class="review-stars">
          <input type="radio" id="star5" name="rating" value="5" required>
          <label for="star5">★</label>
          <input type="radio" id="star4" name="rating" value="4">
          <label for="star4">★</label>
          <input type="radio" id="star3" name="rating" value="3">
          <label for="star3">★</label>
          <input type="radio" id="star2" name="rating" value="2">
          <label for="star2">★</label>
          <input type="radio" id="star1" name="rating" value="1">
          <label for="star1">★</label>
        </div>
      </div>
      <div class="review-form__group">
        <label for="review-text">Ваш отзыв</label>
        <textarea id="review-text" name="text" rows="5" required></textarea>
      </div>
      <button type="submit" class="split-button">Отправить отзыв</button>
    </form>
  </div>
</div>

{% endblock %}
